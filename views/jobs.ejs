<!-- File: jobs-ejs/views/jobs.ejs -->
<%- include("partials/head.ejs") %>
<%- include("partials/header.ejs") %>

<div class="jobs-container">
    <h2>My Job Applications</h2>

    <!-- Button to add a new job application -->
    <div class="actions">
        <a href="/jobs/new">
            <button type="button" class="btn-primary">Add New Job Application</button>
        </a>
    </div>

    <!-- Table displaying all job applications -->
    <table id="jobs-table">
        <thead>
        <tr id="jobs-table-header">
            <th>Company</th>
            <th>Position</th>
            <th>Status</th>
            <th>Date Added</th>
            <th colspan="2">Actions</th>
        </tr>
        </thead>
        <tbody>
        <% if (jobs && jobs.length > 0) { %>
            <% jobs.forEach((job) => { %>
                <tr>
                    <td><%= job.company %></td>
                    <td><%= job.position %></td>
                    <td class="status-<%= job.status %>"><%= job.status %></td>
                    <td><%= job.createdAt ? new Date(job.createdAt).toLocaleDateString() : 'N/A' %></td>
                    <td>
                        <!-- Edit button - uses GET request via link -->
                        <a href="/jobs/edit/<%= job._id %>">
                            <button type="button">Edit</button>
                        </a>
                    </td>
                    <td>
                        <!-- Delete button - uses POST request via form -->
                        <!-- This form is disguised as a button for better UX -->
                        <form method="POST" action="/jobs/delete/<%= job._id %>" style="display: inline"
                              onsubmit="return confirm('Are you sure you want to delete this job application?');">
                            <!-- CSRF token is REQUIRED for this POST request to work -->
                            <input type="hidden" name="_csrf" value="<%= _csrf %>" />
                            <button type="submit">Delete</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        <% } else { %>
            <tr>
                <td colspan="6" style="text-align: center; padding: 20px;">
                    No job applications yet. Click "Add New Job Application" to get started!
                </td>
            </tr>
        <% } %>
        </tbody>
    </table>
</div>

<style>
    .jobs-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .actions {
        margin: 20px 0;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    #jobs-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    #jobs-table th,
    #jobs-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }

    #jobs-table-header {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    #jobs-table tr:hover {
        background-color: #f5f5f5;
    }

    .status-pending {
        color: #856404;
        background-color: #fff3cd;
        padding: 3px 8px;
        border-radius: 3px;
    }

    .status-interview {
        color: #004085;
        background-color: #cce5ff;
        padding: 3px 8px;
        border-radius: 3px;
    }

    .status-declined {
        color: #721c24;
        background-color: #f8d7da;
        padding: 3px 8px;
        border-radius: 3px;
    }

    button {
        padding: 5px 15px;
        margin: 0 2px;
        cursor: pointer;
        border: 1px solid #ccc;
        background-color: white;
        border-radius: 3px;
    }

    button:hover {
        background-color: #e9ecef;
    }

    button[type="submit"] {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
    }

    button[type="submit"]:hover {
        background-color: #c82333;
    }
</style>

<%- include("partials/footer.ejs") %>